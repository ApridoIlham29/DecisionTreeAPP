<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŒ³ Pohon Keputusan Pintar</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2280%22>ðŸŒ³</text></svg>">
    
    <!-- Font Optimization -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Raleway:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- Framework & Library Integration -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/daisyui@2.51.0/dist/full.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/flowbite@1.6.0/dist/flowbite.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tippy.js@6.3.7/themes/light.css" rel="stylesheet">

    <style>
        /* Core Variables & Settings */
        /* Core Variables & Settings */
:root {
    --brand-gradient: linear-gradient(135deg, #1dc071 0%, #1a9c5a 100%);
    --accent-gradient: linear-gradient(135deg, #3498db 0%, #2c88d9 100%);
    --success-gradient: linear-gradient(135deg, #00b894 0%, #00a37f 100%);
    --error-gradient: linear-gradient(135deg, #ff5252 0%, #e53935 100%);
    --warning-gradient: linear-gradient(135deg, #ffb142 0%, #ffa726 100%);
    --surface-gradient: linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%);
    --dark-surface-gradient: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);

    --primary-color: #1a9c5a;
    --secondary-color: #2c88d9;
    --accent-color: #ffa726;
    --success-color: #00a37f;
    --error-color: #e53935;

    --text-primary: #1a202c;
    --text-secondary: #718096;
    --background-light: #f5f7fa;
    --background-dark: #1a202c;
    --card-bg-light: #ffffff;
    --card-bg-dark: #2d3748;
}

/* Base Styles */
body {
    font-family: 'Raleway', sans-serif;
    background: url('https://source.unsplash.com/1600x900/?forest') no-repeat center center fixed;
    background-size: cover;
    min-height: 100vh;
    overflow-x: hidden;
    color: var(--text-primary);
    line-height: 1.6;
    transition: background 0.3s ease, color 0.3s ease;
}

/* App Container */
.app-container {
    max-width: 100%;
    margin: 0 auto;
    padding: 1rem;
    position: relative;
}

/* Page Header */
.page-header {
    background: var(--brand-gradient);
    padding: 2rem 1rem;
    margin: 0 auto 1.5rem auto;
    color: white;
    position: relative;
    overflow: hidden;
    border-radius: 0.75rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    width: 100%;
}

.page-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23ffffff' fill-opacity='0.1' d='M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,112C960,128,1056,160,1152,165.3C1248,171,1344,149,1392,138.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
    background-size: cover;
    background-position: center;
    opacity: 0.3;
}

.app-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 2rem;
    font-weight: 700;
    line-height: 1.2;
    margin-bottom: 0.75rem;
    position: relative;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.app-title::after {
    content: '';
    position: absolute;
    bottom: -0.5rem;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 3px;
    background: white;
    border-radius: 2px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

/* Card Styles */
.card {
    background: var(--card-bg-light);
    border: none;
    border-radius: 0.75rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
    margin-bottom: 1rem;
}

.card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

.card-header {
    background: rgba(248, 250, 252, 0.8);
    border-bottom: 1px solid rgba(226, 232, 240, 0.8);
    padding: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.card-header-icon {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--brand-gradient);
    color: white;
    border-radius: 0.5rem;
    font-size: 1.25rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Form Controls */
.form-control {
    font-family: 'Raleway', sans-serif;
    border-radius: 0.5rem;
    border: 1px solid #e2e8f0;
    padding: 0.625rem 1rem;
    font-size: 0.875rem;
    transition: all 0.3s ease;
    background: white;
    width: 100%;
}

.form-control:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(26, 156, 90, 0.1);
    outline: none;
}

/* Input Group */
.input-group {
    position: relative;
    margin-bottom: 1rem;
}

.input-group label {
    display: block;
    margin-bottom: 0.25rem;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-secondary);
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.input-group:focus-within label {
    color: var(--primary-color);
}

/* Button Styles */
.btn {
    font-family: 'Montserrat', sans-serif;
    font-weight: 600;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    font-size: 0.875rem;
}

.btn::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.3s ease, height 0.3s ease;
}

.btn:hover::after {
    width: 200%;
    height: 200%;
}

.btn-primary {
    background: var(--brand-gradient);
    border: none;
    color: white;
}

.btn-primary:hover {
    box-shadow: 0 4px 8px rgba(26, 156, 90, 0.5);
}

.btn-secondary {
    background: white;
    border: 1px solid #e2e8f0;
    color: var(--text-primary);
}

.btn-secondary:hover {
    background: var(--background-light);
    border-color: #cbd5e1;
    transform: translateY(-1px);
}

/* Tree Container */
.tree-container {
    width: 100%;
    min-height: 300px;
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 0.75rem;
    padding: 1rem;
    position: relative;
    overflow: auto;
    box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
}

.tree-image {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    cursor: move;
    position: relative;
    transform-origin: top left;
    transition: transform 0.3s ease;
}

.tree-controls {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    display: flex;
    gap: 0.5rem;
    background: rgba(255, 255, 255, 0.9);
    padding: 0.5rem;
    border-radius: 0.5rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(4px);
}

.tree-controls button {
    background: white;
    border: none;
    padding: 0.375rem;
    border-radius: 0.375rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.tree-controls button:hover {
    background: var(--background-light);
    transform: translateY(-1px);
}

/* Metrics Grid */
.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.metric-card {
    background: white;
    padding: 1rem;
    border-radius: 0.75rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.metric-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
}

.metric-value {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--primary-color);
}

/* Logs Container */
.logs-container {
    background: #2d3748;
    border-radius: 0.75rem;
    padding: 1rem;
    font-family: 'Roboto Mono', monospace;
    position: relative;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.logs-content {
    max-height: 300px;
    overflow-y: auto;
    color: #f7fafc;
    font-size: 0.75rem;
    line-height: 1.5;
}

.log-entry {
    margin: 0.375rem 0;
    padding: 0.375rem;
    border-bottom: 1px solid #4a5568;
    font-family: 'Roboto Mono', monospace;
    animation: fadeIn 0.3s ease-out;
}

.log-entry[data-type="info"] { color: #3498db; }
.log-entry[data-type="success"] { color: #2ecc71; }
.log-entry[data-type="warning"] { color: #f1c40f; }
.log-entry[data-type="error"] { color: #e74c3c; }
.log-entry[data-type="calc"] { color: #9b59b6; }
.log-entry[data-type="gain"] { color: #1abc9c; }
.log-entry[data-type="entropy"] { color: #95a5a6; }
.log-entry[data-type="result"] { color: #ecf0f1; }
.log-entry[data-type="metric"] { color: #3498db; }
.log-entry[data-type="split"] { color: #2ecc71; }

.log-entry .feature { color: #3498db; }
.log-entry .value { color: #f39c12; }
.log-entry .metric { color: #1abc9c; }
.log-entry .percentage { color: #e74c3c; }

.log-timestamp {
    color: #a0aec0;
    margin-right: 0.5rem;
    font-size: 0.625rem;
}

/* Feature Importance Bar */
.feature-importance-bar {
    background: var(--brand-gradient);
    height: 0.375rem;
    border-radius: 9999px;
    transition: width 1s ease-out, background 0.3s ease;
}

.feature-importance-bar:hover {
    background: var(--accent-gradient);
}

/* Toast Notification */
.toast {
    position: fixed;
    bottom: 1rem;
    right: 1rem;
    padding: 0.75rem;
    border-radius: 0.5rem;
    background: white;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.06);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    z-index: 50;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
}

.toast.show {
    opacity: 1;
    visibility: visible;
}

/* Loading Status */
.loading-overlay {
    position: absolute;
    inset: 0;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(4px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    z-index: 20;
}

.loading-spinner {
    width: 36px;
    height: 36px;
    border: 3px solid #e2e8f0;
    border-top: 3px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

/* Custom Scrollbar */
.custom-scrollbar::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

.custom-scrollbar::-webkit-scrollbar-track {
    background: #edf2f7;
    border-radius: 3px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
    background: #a0aec0;
    border-radius: 3px;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #718096;
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-6px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes slideIn {
    from { transform: translateX(-15px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

@keyframes float {
    0% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
    100% { transform: translateY(0); }
}

/* Responsive Design */
@media (max-width: 1024px) {
    .app-container {
        padding: 0.75rem;
    }

    .app-title {
        font-size: 1.75rem;
    }

    .metrics-grid {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }

    .tree-controls {
        bottom: 0.75rem;
        right: 0.75rem;
        padding: 0.375rem;
    }

    .card {
        margin-bottom: 0.75rem;
    }
}

@media (max-width: 768px) {
    .app-container {
        padding: 0.5rem;
    }

    .app-title {
        font-size: 1.5rem;
    }

    .page-header {
        padding: 1.5rem 1rem;
    }

    .metrics-grid {
        grid-template-columns: 1fr;
    }

    .tree-container {
        min-height: 250px;
    }

    .tree-controls {
        bottom: 0.5rem;
        right: 0.5rem;
        padding: 0.25rem;
    }

    .card {
        margin-bottom: 0.5rem;
    }

    .btn {
        padding: 0.375rem 0.75rem;
        font-size: 0.8125rem;
    }

    .form-control {
        padding: 0.5rem 0.75rem;
        font-size: 0.8125rem;
    }
}

/* Falling Leaves Animation */
.falling-leaves {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
}

.leaf {
    position: absolute;
    width: 15px;
    height: 15px;
    background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%231a9c5a" d="M17,8C8,10 5.9,16.17 3.82,21.34L5.71,22L6.66,19.7C7.14,19.87 7.64,20 8,20C19,20 22,3 22,3C21,5 14,5.25 9,6.25C4,7.25 2,11.5 2,13.5C2,15.5 3.75,17.25 3.75,17.25C7,8 17,8 17,8Z"/></svg>') no-repeat center center;
    background-size: contain;
    animation: falling 5s infinite linear;
}

@keyframes falling {
    0% {
        transform: translate(0, -15vh) rotate(0deg);
    }
    100% {
        transform: translate(100vw, 100vh) rotate(720deg);
    }
}

/* Tooltip Styles */
.tippy-box[data-theme~='forest'] {
    background-color: #1a9c5a;
    color: white;
}

.tippy-box[data-theme~='forest'][data-placement^='top'] > .tippy-arrow::before {
    border-top-color: #1a9c5a;
}

.tippy-box[data-theme~='forest'][data-placement^='bottom'] > .tippy-arrow::before {
    border-bottom-color: #1a9c5a;
}

.tippy-box[data-theme~='forest'][data-placement^='left'] > .tippy-arrow::before {
    border-left-color: #1a9c5a;
}

.tippy-box[data-theme~='forest'][data-placement^='right'] > .tippy-arrow::before {
    border-right-color: #1a9c5a;
}

/* Floating Animation */
.float {
    animation: float 3s ease-in-out infinite;
}

/* Mobile Optimization for iPhone 15 */
@media (max-width: 428px) {
    html {
        font-size: 14px;
    }

    body {
        font-size: 14px;
    }

    .app-container {
        padding: 0.5rem;
    }

    .app-container * {
        max-width: 100%;
    }

    .page-header {
        padding: 1rem 0.5rem;
    }

    .app-title {
        font-size: 1.5rem;
    }

    .card {
        margin-bottom: 0.75rem;
        padding: 0.75rem;
    }

    .card-header {
        padding: 0.5rem;
    }

    .card-header-icon {
        width: 28px;
        height: 28px;
        font-size: 1rem;
    }

    .form-control {
        padding: 0.4rem 0.75rem;
        font-size: 0.875rem;
    }

    .input-group {
        margin-bottom: 0.75rem;
    }

    .input-group label {
        font-size: 0.7rem;
        margin-bottom: 0.2rem;
    }

    #trainingData {
        min-height: 120px;
    }

    .btn {
        padding: 0.375rem 0.75rem;
        font-size: 0.8125rem;
    }

    .btn-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .btn-group .btn {
        width: 100%;
    }

    .tree-container {
        min-height: 200px;
    }

    .tree-controls {
        bottom: 0.25rem;
        right: 0.25rem;
        padding: 0.25rem;
        flex-wrap: wrap;
        justify-content: center;
    }

    .tree-controls button {
        padding: 0.25rem;
        font-size: 0.75rem;
    }

    .metrics-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem;
    }

    .metric-card {
        padding: 0.75rem;
    }

    .metric-value {
        font-size: 1.25rem;
    }

    .logs-container {
        padding: 0.75rem;
    }

    .logs-content {
        max-height: 200px;
        font-size: 0.7rem;
    }

    table {
        font-size: 0.75rem;
    }

    th, td {
        padding: 0.3rem;
    }

    img, svg {
        max-width: 100%;
        height: auto;
    }
}
    </style>
</head>
<body>
    <div class="app-container">
        <header class="page-header text-center">
            <h1 class="app-title animate__animated animate__fadeInDown">
                ðŸŒ³ Pohon Keputusan Pintar
            </h1>
            <p class="text-lg text-white animate__animated animate__fadeInUp animate__delay-1s">
                Bangun dan visualisasikan pohon keputusan Anda
            </p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Left Column -->
            <div class="space-y-6">
                <!-- Dataset Card -->
                <div class="card p-6" data-aos="fade-up">
                    <div class="card-header">
                        <span class="card-header-icon">
                            <i class="fas fa-database"></i>
                        </span>
                        <h2 class="text-xl font-semibold">Dataset</h2>
                    </div>
                    <div class="card-body mt-4">
                        <div class="flex flex-wrap justify-between items-center mb-4">
                            <div class="flex items-center gap-2 flex-grow mr-2 mb-2 sm:mb-0">
                                <label for="datasetName" class="font-medium">Dataset Name:</label>
                                <input type="text" id="datasetName" class="form-control" data-tippy-content="Enter a unique name for your dataset">
                            </div>
                            <button onclick="saveDataset()" class="btn btn-primary" data-tippy-content="Save current dataset">
                                <i class="fas fa-save"></i> Save
                            </button>
                        </div>
                        <div class="input-group">
                            <label for="datasetSelect">Select Dataset:</label>
                            <select id="datasetSelect" class="form-control" onchange="loadDataset()" data-tippy-content="Choose a saved dataset">
                                <option value="">-- Select Dataset --</option>
                                {% for dataset in datasets %}
                                <option value="{{ dataset.id }}">{{ dataset.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="flex justify-end mt-4">
                            <button onclick="updateDataset()" class="btn btn-secondary mr-2" data-tippy-content="Update selected dataset">
                                <i class="fas fa-edit"></i> Update
                            </button>
                            <button onclick="deleteDataset()" class="btn btn-secondary" data-tippy-content="Delete selected dataset">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Parameters Card -->
                <div class="card p-6" data-aos="fade-up" data-aos-delay="100">
                    <div class="card-header">
                        <span class="card-header-icon">
                            <i class="fas fa-cogs"></i>
                        </span>
                        <h2 class="text-xl font-semibold">Parameters</h2>
                    </div>
                    <div class="card-body mt-4">
                        <div class="input-group">
                            <label for="parameters">Parameter List:</label>
                            <input type="text" id="parameters" class="form-control" 
                                placeholder="e.g. outlook, temperature, humidity, play"
                                data-tippy-content="Enter comma-separated parameters. The last parameter will be the target variable.">
                        </div>
                        <div class="text-sm text-text-secondary mt-2">
                            Enter comma-separated parameters. The last parameter will be the target variable.
                        </div>
                    </div>
                </div>

                <!-- Training Data Card -->
                <div class="card p-6" data-aos="fade-up" data-aos-delay="200">
                    <div class="card-header">
                        <span class="card-header-icon">
                            <i class="fas fa-table"></i>
                        </span>
                        <h2 class="text-xl font-semibold">Training Data</h2>
                    </div>
                    <div class="card-body mt-4">
                        <div class="input-group">
                            <label for="trainingData">Training Dataset:</label>
                            <textarea id="trainingData" rows="6" class="form-control custom-scrollbar"
                                placeholder="Enter one data per line, comma-separated"
                                data-tippy-content="Enter your training data here. One line per data entry."></textarea>
                        </div>
                        <div class="flex justify-between mt-4">
                            <button onclick="buildTree()" class="btn btn-primary" data-tippy-content="Start building the decision tree">
                                <i class="fas fa-play"></i>
                                Build Tree
                            </button>
                            <button onclick="insertExampleData()" class="btn btn-secondary" data-tippy-content="Load example data to try out">
                                <i class="fas fa-lightbulb"></i>
                                Load Example
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Data Preview Card -->
                <div class="card p-6" data-aos="fade-up" data-aos-delay="300">
                    <div class="card-header">
                        <span class="card-header-icon">
                            <i class="fas fa-table"></i>
                        </span>
                        <h2 class="text-xl font-semibold">Preview Data</h2>
                    </div>
                    <div class="card-body mt-4">
                        <div class="overflow-x-auto">
                            <table class="table-auto border-collapse w-full">
                                <thead>
                                    <tr id="tableHeader" class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                                        <!-- Header akan ditambahkan secara dinamis -->
                                    </tr>
                                </thead>
                                <tbody id="tableBody" class="text-gray-600 text-sm">
                                    <!-- Baris data akan ditambahkan secara dinamis -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="space-y-6">
                <!-- Tree Visualization Card -->
                <div class="card p-6" data-aos="fade-up">
                    <div class="card-header">
                        <span class="card-header-icon">
                            <i class="fas fa-project-diagram"></i>
                        </span>
                        <h2 class="text-xl font-semibold">Tree Visualization</h2>
                    </div>
                    <div class="card-body mt-4">
                        <div class="tree-container">
                            <img id="treeVisualization" class="tree-image" alt="Decision Tree Visualization">
                            <div class="tree-controls">
                                <button onclick="zoomIn()" class="btn btn-secondary" data-tippy-content="Zoom In">
                                    <i class="fas fa-search-plus"></i>
                                </button>
                                <button onclick="zoomOut()" class="btn btn-secondary" data-tippy-content="Zoom Out">
                                    <i class="fas fa-search-minus"></i>
                                </button>
                                <button onclick="resetZoom()" class="btn btn-secondary" data-tippy-content="Reset Zoom">
                                    <i class="fas fa-compress-arrows-alt"></i>
                                </button>
                                <button onclick="downloadTree()" class="btn btn-secondary" data-tippy-content="Download Tree Image">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tree Metrics Card -->
                <div class="card p-6" data-aos="fade-up" data-aos-delay="100">
                    <div class="card-header">
                        <span class="card-header-icon">
                            <i class="fas fa-chart-bar"></i>
                        </span>
                        <h2 class="text-xl font-semibold">Tree Metrics</h2>
                    </div>
                    <div class="card-body mt-4">
                        <div id="metrics" class="metrics-grid">
                            <!-- Metrics will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Build Logs Card -->
                <div class="card p-6" data-aos="fade-up" data-aos-delay="200">
                    <div class="card-header">
                        <span class="card-header-icon">
                            <i class="fas fa-terminal"></i>
                        </span>
                        <h2 class="text-xl font-semibold">Build Logs</h2>
                    </div>
                    <div class="card-body mt-4">
                        <div class="logs-container">
                            <div id="buildLogs" class="logs-content custom-scrollbar">
                                <!-- Logs will be inserted here -->
                            </div>
                            <div class="logs-actions mt-4">
                                <button onclick="clearLogs()" class="btn btn-secondary mr-2" data-tippy-content="Clear all logs">
                                    <i class="fas fa-trash-alt"></i> Clear
                                </button>
                                <button onclick="copyLogs()" class="btn btn-secondary mr-2" data-tippy-content="Copy logs to clipboard">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                                <button onclick="downloadLogs()" class="btn btn-secondary" data-tippy-content="Download logs as text file">
                                    <i class="fas fa-download"></i> Save
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="bg-gray-900 text-white py-6 mt-8">
            <div class="container mx-auto text-center">
                <p class="text-lg font-medium mb-4">ðŸŒ³ Aprido Ilham &copy; 2024</p>
                <div class="flex justify-center space-x-4">
                    <a href="https://www.linkedin.com/in/aprido-ilham-900344253/" class="text-white hover:text-primary-color transition-colors duration-200">
                        <i class="fab fa-linkedin fa-lg"></i>
                    </a>
                    <a href="https://www.instagram.com/apridoilham/" class="text-white hover:text-primary-color transition-colors duration-200">
                        <i class="fab fa-instagram fa-lg"></i>
                    </a>
                    <a href="https://github.com/ApridoIlham29" class="text-white hover:text-primary-color transition-colors duration-200">
                        <i class="fab fa-github fa-lg"></i>
                    </a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fas fa-info-circle"></i>
        <span id="toastMessage"></span>
    </div>

    <!-- Falling Leaves Animation -->
    <div class="falling-leaves"></div>

    <!-- Import Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/daisyui@2.51.0/dist/full.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@1.6.0/dist/flowbite.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>

    <!-- AOS Initialization -->
    <script>
        AOS.init({
            duration: 800,
            offset: 100,
            once: true
        });
    </script>

    <!-- Main App Script -->
    <script>
        // Global variables
        let currentZoom = 1;
        const zoomStep = 0.1;
        let buildLogsHistory = [];
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;

        // Toast notification function
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toast.className = `toast toast-${type}`;
            toastMessage.textContent = message;
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Log functions
        function addLogEntry(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            
            message = message.replace(
                /(fitur|Gain|entropi|Nilai) ['']([^'']+)['']:/g, 
                `$1 <span class="value">'$2'</span>:`
            );
            
            message = message.replace(
                /(\d+\.\d+)%?/g,
                `<span class="percentage">$1</span>${message.includes('%') ? '%' : ''}`
            );
            
            let messageType = type;
            if (message.includes('Menghitung Gain')) messageType = 'calc';
            else if (message.includes('Gain untuk fitur')) messageType = 'gain';
            else if (message.includes('Entropi total')) messageType = 'entropy';
            else if (message.includes('Fitur terbaik')) messageType = 'result';
            else if (message.includes('sampel')) messageType = 'metric';
            else if (message.includes('Split:')) messageType = 'split';
            
            buildLogsHistory.push({ message, type: messageType, timestamp });
            updateLogsDisplay();
        }

        function updateLogsDisplay() {
            const logsContainer = document.getElementById('buildLogs');
            logsContainer.innerHTML = buildLogsHistory
                .map(log => `
                    <div class="log-entry" data-type="${log.type}">
                        <span class="log-timestamp">${log.timestamp}</span>
                        ${log.message}
                    </div>
                `)
                .join('');
            
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        function clearLogs() {
            buildLogsHistory = [];
            updateLogsDisplay();
            showToast('Build logs cleared', 'info');
        }

        function copyLogs() {
            const logsText = buildLogsHistory
                .map(log => `[${log.timestamp}] ${log.message}`)
                .join('\n');
            
            navigator.clipboard.writeText(logsText)
                .then(() => showToast('Logs copied to clipboard', 'success'))
                .catch(() => showToast('Failed to copy logs', 'error'));
        }

        function downloadLogs() {
            const logsText = buildLogsHistory
                .map(log => `[${log.timestamp}] ${log.message}`)
                .join('\n');
            
            const blob = new Blob([logsText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `decision-tree-build-log-${new Date().toISOString().slice(0,10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Logs downloaded successfully', 'success');
        }

        // Tree visualization functions
        function zoomIn() {
            currentZoom = Math.min(currentZoom + zoomStep, 3);
            applyZoom();
        }

        function zoomOut() {
            currentZoom = Math.max(currentZoom - zoomStep, 0.5);
            applyZoom();
        }

        function resetZoom() {
            currentZoom = 1;
            xOffset = 0;
            yOffset = 0;
            applyZoom();
        }

        function applyZoom() {
            const img = document.getElementById('treeVisualization');
            img.style.transform = `translate(${xOffset}px, ${yOffset}px) scale(${currentZoom})`;
        }

        function downloadTree() {
            const img = document.getElementById('treeVisualization');
            if (img.src) {
                const a = document.createElement('a');
                a.href = img.src;
                a.download = 'decision-tree.png';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                showToast('Tree image downloaded!', 'success');
            } else {
                showToast('No tree visualization available', 'error');
            }
        }

        // Main function to build the tree
        async function buildTree() {
            const parameters = document.getElementById('parameters').value;
            const data = document.getElementById('trainingData').value;
            
            if (!parameters.trim() || !data.trim()) {
                showToast('Please fill in all required fields', 'error');
                addLogEntry('Build failed: Required fields empty', 'error');
                return;
            }

            addLogEntry('Starting tree build process...', 'info');
            addLogEntry(`Parameters: ${parameters}`, 'info');
            addLogEntry(`Dataset size: ${data.split('\n').length} samples`, 'info');

            const loadingOverlay = document.createElement('div');
            loadingOverlay.className = 'loading-overlay';
            loadingOverlay.innerHTML = '<div class="loading-spinner"></div>';
            document.querySelector('.tree-container').appendChild(loadingOverlay);

            try {
                addLogEntry('Sending request to server...', 'info');
                
                const response = await fetch('/build_tree', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        parameters,
                        data,
                        options: {
                            minSamplesSplit: 2,
                            maxDepth: 10,
                            criterion: 'gini'
                        }
                    })
                });
                
                const result = await response.json();
                
                if (result.error) {
                    addLogEntry(`Build failed: ${result.error}`, 'error');
                    showToast(result.error, 'error');
                    return;
                }

                if (result.logs && Array.isArray(result.logs)) {
                    result.logs.forEach(log => addLogEntry(log, 'info'));
                }

                const treeVisualization = document.getElementById('treeVisualization');
                treeVisualization.src = `data:image/png;base64,${result.visualization}`;
                resetZoom();
                
                addLogEntry('Tree visualization updated', 'success');
                updateMetrics(result.metrics);
                addLogEntry('Metrics updated', 'success');
                
                addLogEntry('Tree build successful', 'success');
                showToast('Decision tree built successfully!', 'success');
                
            } catch (error) {
                addLogEntry(`Error building tree: ${error.message}`, 'error');
                showToast('Error building tree: ' + error.message, 'error');
            } finally {
                document.querySelector('.loading-overlay').remove();
            }
        }

        // Function to update metrics
        function updateMetrics(metrics) {
            const metricsContainer = document.getElementById('metrics');
            const parameters = document.getElementById('parameters').value.split(',');
            const features = parameters.slice(0, -1);
            const target = parameters[parameters.length - 1];
            
            const createdDate = new Date(metrics.created_at);
            const formattedDate = createdDate.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            const formattedTime = createdDate.toLocaleTimeString('id-ID');
        
            const metricCards = [
                {
                    icon: 'fa-calendar',
                    title: 'Dibuat',
                    value: `${formattedDate} ${formattedTime}`
                },
                {
                    icon: 'fa-clock',
                    title: 'Waktu Pembangunan',
                    value: `${metrics.build_time.toFixed(2)}d`
                },
                {
                    icon: 'fa-list',
                    title: 'Fitur',
                    value: `${features.join(', ')}`
                },
                {
                    icon: 'fa-bullseye',
                    title: 'Variabel Target',
                    value: target
                },
            ];
        
            let html = metricCards.map(card => `
                <div class="metric-card">
                    <div class="flex items-center gap-2">
                        <i class="fas ${card.icon} text-primary-color"></i>
                        <span class="text-sm font-medium">${card.title}</span>
                    </div>
                    <div class="metric-value">${card.value}</div>
                </div>
            `).join('');
        
            if (metrics.feature_importance) {
                html += `
                    <div class="metric-card col-span-full">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-chart-pie text-primary-color"></i>
                            <span class="text-lg font-semibold">Kepentingan Fitur</span>
                        </div>
                        <div class="grid gap-2">
                            ${Object.entries(metrics.feature_importance)
                                .sort((a, b) => b[1] - a[1])
                                .map(([feature, value]) => `
                                    <div class="flex items-center gap-2">
                                        <div class="flex-grow text-sm">${feature}</div>
                                        <div class="font-medium text-sm">${(value * 100).toFixed(1)}%</div>
                                        <div class="w-24 h-2 bg-gray-200 rounded-full">
                                            <div class="feature-importance-bar" 
                                                style="width: ${value * 100}%"></div>
                                        </div>
                                    </div>
                                `).join('')}
                        </div>
                    </div>
                `;
            }
        
            metricsContainer.innerHTML = html;
        
            if (metrics.feature_importance) {
                initFeatureImportanceChart(metrics.feature_importance);
            }
        }

        // Dataset functions
        async function saveDataset() {
            const name = document.getElementById('datasetName').value;
            const parameters = document.getElementById('parameters').value;
            const data = document.getElementById('trainingData').value;

            if (!name || !parameters || !data) {
                showToast('Please fill in all fields', 'error');
                return;
            }

            try {
                const response = await fetch('/save_dataset', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        parameters: parameters.split(',').map(p => p.trim()),
                        data: data.trim().split('\n').map(row => row.trim().split(','))
                    })
                });

                const result = await response.json();

                if (result.error) {
                    showToast(result.error, 'error');
                } else {
                    showToast('Dataset saved successfully', 'success');
                    location.reload();
                }
            } catch (error) {
                showToast('Error saving dataset: ' + error.message, 'error');
            }
        }

        async function loadDataset() {
            const datasetSelect = document.getElementById('datasetSelect');
            const datasetId = datasetSelect.value;

            if (!datasetId) {
                document.getElementById('datasetName').value = '';
                document.getElementById('parameters').value = '';
                document.getElementById('trainingData').value = '';
                return;
            }

            try {
                const response = await fetch(`/load_dataset/${datasetId}`);
                const result = await response.json();

                if (result.error) {
                    showToast(result.error, 'error');
                } else {
                    document.getElementById('datasetName').value = result.name;
                    document.getElementById('parameters').value = result.parameters.join(', ');
                    document.getElementById('trainingData').value = result.data.map(row => row.join(',')).join('\n');
                    showToast('Dataset loaded successfully', 'success');
                }
            } catch (error) {
                showToast('Error loading dataset: ' + error.message, 'error');
            }
        }

        async function updateDataset() {
            const datasetSelect = document.getElementById('datasetSelect');
            const datasetId = datasetSelect.value;

            if (!datasetId) {
                showToast('Please select a dataset to update', 'error');
                return;
            }

            const name = document.getElementById('datasetName').value;
            const parameters = document.getElementById('parameters').value;
            const data = document.getElementById('trainingData').value;

            try {
                const response = await fetch(`/update_dataset/${datasetId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        parameters: parameters.split(',').map(p => p.trim()),
                        data: data.trim().split('\n').map(row => row.trim().split(','))
                    })
                });

                const result = await response.json();

                if (result.error) {
                    showToast(result.error, 'error');
                } else {
                    showToast('Dataset updated successfully', 'success');
                }
            } catch (error) {
                showToast('Error updating dataset: ' + error.message, 'error');
            }
        }

        async function deleteDataset() {
            const datasetSelect = document.getElementById('datasetSelect');
            const datasetId = datasetSelect.value;

            if (!datasetId) {
                showToast('Please select a dataset to delete', 'error');
                return;
            }

            try {
                const response = await fetch(`/delete_dataset/${datasetId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.error) {
                    showToast(result.error, 'error');
                } else {
                    showToast('Dataset deleted successfully', 'success');
                    location.reload();
                }
            } catch (error) {
                showToast('Error deleting dataset: ' + error.message, 'error');
            }
        }

        // Example data function
        function insertExampleData() {
            document.getElementById('parameters').value = 'outlook,temperature,humidity,play';
            document.getElementById('trainingData').value = 
                'sunny,hot,high,no\n' +
                'sunny,hot,high,no\n' +
                'overcast,hot,high,yes\n' +
                'rainy,mild,high,yes\n' +
                'rainy,cool,normal,yes\n' +
                'rainy,cool,normal,no\n' +
                'overcast,cool,normal,yes';
            
            showToast('Example data loaded successfully', 'success');
            addLogEntry('Example data loaded', 'info');
        }

        // Tree visualization drag functionality
        const treeImage = document.getElementById('treeVisualization');

        function dragStart(e) {
            initialX = e.clientX - xOffset;
            initialY = e.clientY - yOffset;

            if (e.target === treeImage) {
                isDragging = true;
            }
        }

        function dragEnd() {
            initialX = currentX;
            initialY = currentY;
            isDragging = false;
        }

        function drag(e) {
            if (isDragging) {
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
                xOffset = currentX;
                yOffset = currentY;
                setTranslate(currentX, currentY, treeImage);
            }
        }

        function setTranslate(xPos, yPos, el) {
            el.style.transform = `translate(${xPos}px, ${yPos}px) scale(${currentZoom})`;
        }

        // Function to update data table
        function updateDataTable() {
            const parameters = document.getElementById('parameters').value;
            const data = document.getElementById('trainingData').value;

            if (!parameters || !data) {
                // Clear table if no data
                const tableHeader = document.getElementById('tableHeader');
                const tableBody = document.getElementById('tableBody');
                tableHeader.innerHTML = '';
                tableBody.innerHTML = '';
                return;
            }

            // Parse parameters
            const headers = parameters.split(',').map(param => param.trim());

            // Parse data
            const rows = data.split('\n')
                .filter(row => row.trim()) // Remove empty lines
                .map(row => row.split(',').map(cell => cell.trim()));

            // Update table header only if there is data
            const tableHeader = document.getElementById('tableHeader');
            if (rows.length > 0) {
                tableHeader.innerHTML = `
                    <th style="width: 50px;">No</th>
                    ${headers.map(header => `<th>${header}</th>`).join('')}
                `;
            }

            // Update table body
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = rows
                .map((row, index) => `
                    <tr>
                        <td style="text-align: center;">${index + 1}</td>
                        ${row.map(cell => `<td>${cell}</td>`).join('')}
                    </tr>
                `)
                .join('');
        }

        // Add event listeners to update table when data changes
        document.getElementById('parameters').addEventListener('input', updateDataTable);
        document.getElementById('trainingData').addEventListener('input', updateDataTable);

        // Update table when example data is loaded
        const originalInsertExampleData = window.insertExampleData;
        window.insertExampleData = function() {
            originalInsertExampleData();
            updateDataTable();
        };

        // Update table when dataset is loaded
        const originalLoadDataset = window.loadDataset;
        window.loadDataset = async function() {
            await originalLoadDataset();
            updateDataTable();
        };

        // Event Listeners
        treeImage.addEventListener('mousedown', dragStart);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', dragEnd);
        document.addEventListener('mouseleave', dragEnd);

        // Keyboard Shortcuts
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                buildTree();
            }
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'E') {
                e.preventDefault();
                insertExampleData();
            }
            if ((e.ctrlKey || e.metaKey) && e.code === 'Equal') {
                e.preventDefault();
                zoomIn();
            }
            if ((e.ctrlKey || e.metaKey) && e.code === 'Minus') {
                e.preventDefault();
                zoomOut();
            }
            if ((e.ctrlKey || e.metaKey) && e.code === 'Digit0') {
                e.preventDefault();
                resetZoom();
            }
        });

        // Local Storage Functions
        function saveToLocalStorage() {
            const parameters = document.getElementById('parameters').value;
            const trainingData = document.getElementById('trainingData').value;
            const datasetName = document.getElementById('datasetName').value;
            
            localStorage.setItem('dtb-parameters', parameters);
            localStorage.setItem('dtb-training-data', trainingData);
            localStorage.setItem('dtb-dataset-name', datasetName);
        }

        // Tooltip Initialization
        tippy('[data-tippy-content]', {
            theme: 'forest',
            animation: 'scale',
        });

        // Auto-save Timer
        setInterval(saveToLocalStorage, 30000);

        // Initialization on Load
        window.addEventListener('load', () => {
            // Clear all fields on initial load
            document.getElementById('datasetName').value = '';
            document.getElementById('parameters').value = '';
            document.getElementById('trainingData').value = '';
            
            // Reset dataset select to default option
            const datasetSelect = document.getElementById('datasetSelect');
            if (datasetSelect) {
                datasetSelect.selectedIndex = 0;
            }

            addLogEntry('App initialized successfully', 'success');

            // Add falling leaves animation
            createFallingLeaves();
        });

        // Falling Leaves Animation
        function createFallingLeaves() {
            const leavesContainer = document.querySelector('.falling-leaves');
            const numberOfLeaves = 20;

            for (let i = 0; i < numberOfLeaves; i++) {
                const leaf = document.createElement('div');
                leaf.classList.add('leaf');
                leaf.style.left = `${Math.random() * 100}vw`;
                leaf.style.animationDuration = `${Math.random() * 5 + 5}s`;
                leaf.style.animationDelay = `${Math.random() * 5}s`;
                leavesContainer.appendChild(leaf);
            }
        }

        // User Guide Function
        function showUserGuide() {
            const steps = [
                {
                    element: '#parameters',
                    title: 'Enter Parameters',
                    intro: 'Enter comma-separated parameters. The last parameter is the target variable.'
                },
                {
                    element: '#trainingData',
                    title: 'Enter Training Data',
                    intro: 'Enter your training data, one line per data entry, comma-separated.'
                },
                {
                    element: 'button[onclick="buildTree()"]',
                    title: 'Build Tree',
                    intro: 'Click here to build the decision tree based on your data.'
                },
                {
                    element: '#treeVisualization',
                    title: 'Tree Visualization',
                    intro: 'Your decision tree will be displayed here after it is built.'
                },
                {
                    element: '#metrics',
                    title: 'Tree Metrics',
                    intro: 'View various metrics related to your decision tree here.'
                },
                {
                    element: '#buildLogs',
                    title: 'Build Logs',
                    intro: 'See detailed logs of the tree building process here.'
                }
            ];

            introJs().setOptions({
                steps: steps,
                nextLabel: 'Next',
                prevLabel: 'Back',
                doneLabel: 'Finish',
                exitOnOverlayClick: false,
                exitOnEsc: false,
                showStepNumbers: false,
                showBullets: false,
                showProgress: true
            }).start();
        }

        // Feature Importance Chart Initialization
        function initFeatureImportanceChart(data) {
            const canvas = document.getElementById('featureImportanceChart');
            if (!canvas) {
                console.error('Canvas element not found');
                return;
            }

            const ctx = canvas.getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        label: 'Feature Importance',
                        data: Object.values(data),
                        backgroundColor: 'rgba(26, 156, 90, 0.8)',
                        borderColor: 'rgba(26, 156, 90, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(26, 156, 90, 0.9)',
                            titleFont: {
                                size: 16
                            },
                            bodyFont: {
                                size: 14
                            },
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    return `Importance: ${(value * 100).toFixed(2)}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Function to export results to PDF
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Add title
            doc.setFontSize(24);
            doc.text('Decision Tree Report', 105, 20, null, null, 'center');

            // Add tree image
            const treeImg = document.getElementById('treeVisualization');
            doc.addImage(treeImg.src, 'PNG', 15, 40, 180, 120);

            // Add metrics
            doc.setFontSize(18);
            doc.text('Tree Metrics:', 15, 170);
            const metrics = document.getElementById('metrics').innerText;
            doc.setFontSize(12);
            doc.text(metrics, 15, 180);

            // Add build logs
            doc.addPage();
            doc.setFontSize(18);
            doc.text('Build Logs:', 15, 20);
            const logs = document.getElementById('buildLogs').innerText;
            doc.setFontSize(10);
            doc.text(logs, 15, 30);

            // Save PDF
            doc.save('decision-tree-report.pdf');
        }
    </script>
</body>
</html>